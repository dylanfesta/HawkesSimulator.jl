<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>1D and 2D Hawkes processes with exponential kernel · HawkesSimulator.jl</title><meta name="title" content="1D and 2D Hawkes processes with exponential kernel · HawkesSimulator.jl"/><meta property="og:title" content="1D and 2D Hawkes processes with exponential kernel · HawkesSimulator.jl"/><meta property="twitter:title" content="1D and 2D Hawkes processes with exponential kernel · HawkesSimulator.jl"/><meta name="description" content="Documentation for HawkesSimulator.jl."/><meta property="og:description" content="Documentation for HawkesSimulator.jl."/><meta property="twitter:description" content="Documentation for HawkesSimulator.jl."/><meta property="og:url" content="https://dylanfesta.github.io/HawkesSimulator.jl/exp_1and2D/"/><meta property="twitter:url" content="https://dylanfesta.github.io/HawkesSimulator.jl/exp_1and2D/"/><link rel="canonical" href="https://dylanfesta.github.io/HawkesSimulator.jl/exp_1and2D/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">HawkesSimulator.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>1D and 2D Hawkes processes with exponential kernel</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>1D and 2D Hawkes processes with exponential kernel</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/dylanfesta/HawkesSimulator.jl/blob/master/examples/exp_1and2D.jl" title="View source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="1D-and-2D-Hawkes-processes-with-exponential-kernel"><a class="docs-heading-anchor" href="#1D-and-2D-Hawkes-processes-with-exponential-kernel">1D and 2D Hawkes processes with exponential kernel</a><a id="1D-and-2D-Hawkes-processes-with-exponential-kernel-1"></a><a class="docs-heading-anchor-permalink" href="#1D-and-2D-Hawkes-processes-with-exponential-kernel" title="Permalink"></a></h1><p>In this example, I simulate first a 1D self-exciting Hawkes process and then a 2D one. The interaction kernel is an exponentially decaying function, defined as:</p><p class="math-container">\[g(t) = H(t) \,  \frac{1}{\tau} \, \exp\left(- \frac{t}{\tau} \right)\]</p><p>where <span>$H(t)$</span> is the Heaviside function: zero for <span>$t&lt;0$</span>, one for <span>$t\geq 0$</span>.</p><p>Note that Kernels are always normalized so that their integral between <span>$-\infty$</span> and <span>$+\infty$</span> is 1.</p><h2 id="Initialization"><a class="docs-heading-anchor" href="#Initialization">Initialization</a><a id="Initialization-1"></a><a class="docs-heading-anchor-permalink" href="#Initialization" title="Permalink"></a></h2><pre><code class="language-julia hljs">using LinearAlgebra,Statistics,StatsBase,Distributions
using Plots,NamedColors ; theme(:default) ; gr()
using FFTW

using ProgressMeter
using Random
Random.seed!(0)

using HawkesSimulator; const global H = HawkesSimulator

&quot;&quot;&quot;
    onedmat(x::R) where R
Generates a 1-by-1 Matrix{R} that contains `x` as only element
&quot;&quot;&quot;
function onedmat(x::R) where R
  return cat(x;dims=2)
end;</code></pre><p>First I define the kernel, and the self-interaction weight.</p><p><code>myw</code> is a scaling factor (the weight of the autaptic connection). The baseline rate is given by <code>myinput</code></p><pre><code class="language-julia hljs">mytau = 0.5  # kernel time constant
myw = onedmat(0.85) # weight: this needs to be a matrix
myinput = [0.7,] # this needs to be a vector
mykernel = H.KernelExp(mytau);</code></pre><p>This is the plot of the (self) interaction kernel (before  the scaling by <code>myw</code>)</p><pre><code class="language-julia hljs">theplot = let ts = range(-1.0,5;length=150),
  y = map(t-&gt;H.interaction_kernel(t,mykernel) , ts )
  plot(ts , y ; linewidth=3,leg=false,xlabel=&quot;time (s)&quot;,
    color = :black,
     ylabel=&quot;interaction kernel&quot;)
end;
plot(theplot)</code></pre><img src="3ae31d55.svg" alt="Example block output"/><p>Now I build the network, using the simplified constructor for one-population networks. The object <code>PopulationState</code> initializes a population of Hawkes neurons of the specified size (1, in this case) and the kernel <code>mykernel</code> neurons in the same population all have the same kernel. (this might be an inconvenience if one wants qualitatively different self-connections... but it might be fixed in future versions)</p><pre><code class="language-julia hljs">popstate = H.PopulationState(mykernel,1)
ntw = H.RecurrentNetwork(popstate,myw,myinput);</code></pre><h2 id="Simulation"><a class="docs-heading-anchor" href="#Simulation">Simulation</a><a id="Simulation-1"></a><a class="docs-heading-anchor-permalink" href="#Simulation" title="Permalink"></a></h2><p>The length of the simulation is measured by the total number of spikes here called <code>num_spikes</code>. The function <code>flush_trains!(...)</code> is used to store older spikes as history and let them be ignored by the kernels. The time parameters should be regulated based on the kernel shape.</p><pre><code class="language-julia hljs">function run_simulation!(network,num_spikes,
    t_flush_trigger=300.0,t_flush=100.0)
  t_now = 0.0
  H.reset!(network) # clear spike trains etc
  @showprogress &quot;Running Hawkes process...&quot; for _ in 1:num_spikes
    t_now = H.dynamics_step_singlepopulation!(t_now,network)
    H.flush_trains!(network,t_flush_trigger;Tflush=t_flush)
  end
  H.flush_trains!(network) # flush everything into history
  return t_now
end

n_spikes = 100_000
Tmax = run_simulation!(ntw,n_spikes)
ratenum = H.numerical_rates(popstate;Tend=Tmax)[1]
@info &quot;Simulation completed, mean rate $(round(ratenum;digits=2)) Hz&quot;

#</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Running Hawkes process...  10%|██▋                       |  ETA: 0:00:01Running Hawkes process...  19%|█████                     |  ETA: 0:00:01Running Hawkes process...  29%|███████▌                  |  ETA: 0:00:01Running Hawkes process...  38%|█████████▉                |  ETA: 0:00:01Running Hawkes process...  47%|████████████▏             |  ETA: 0:00:01Running Hawkes process...  55%|██████████████▍           |  ETA: 0:00:01Running Hawkes process...  63%|████████████████▌         |  ETA: 0:00:00Running Hawkes process...  72%|██████████████████▋       |  ETA: 0:00:00Running Hawkes process...  80%|████████████████████▊     |  ETA: 0:00:00Running Hawkes process...  88%|██████████████████████▉   |  ETA: 0:00:00Running Hawkes process...  96%|████████████████████████▉ |  ETA: 0:00:00Running Hawkes process... 100%|██████████████████████████| Time: 0:00:01
[ Info: Simulation completed, mean rate 4.5 Hz</code></pre><h2 id="Visualize-raster-plot-of-the-events"><a class="docs-heading-anchor" href="#Visualize-raster-plot-of-the-events">Visualize raster plot of the events</a><a id="Visualize-raster-plot-of-the-events-1"></a><a class="docs-heading-anchor-permalink" href="#Visualize-raster-plot-of-the-events" title="Permalink"></a></h2><p>the raster plot shows some correlation between the neural activities neuron one (lower row) excites neuron two (upper row)</p><pre><code class="language-julia hljs">function rasterplot(tlims = (1100.,1120.) )
  _train = popstate.trains_history[1]
  plt=plot()
  train = filter(t-&gt; tlims[1]&lt; t &lt; tlims[2],_train)
  nspk = length(train)
  scatter!(plt,train,fill(0.1,nspk),markersize=30,
      markercolor=:black,markershape=:vline,leg=false)
  return plot!(plt,ylims=(0.0,0.2),xlabel=&quot;time (s)&quot;)
end

rasterplot()</code></pre><img src="a6a312c9.svg" alt="Example block output"/><p>event times are always stored in <code>pops.trains_history</code></p><h2 id="Plot-the-instantaneous-rate"><a class="docs-heading-anchor" href="#Plot-the-instantaneous-rate">Plot the instantaneous rate</a><a id="Plot-the-instantaneous-rate-1"></a><a class="docs-heading-anchor-permalink" href="#Plot-the-instantaneous-rate" title="Permalink"></a></h2><p>This is the probability of a spike given the past activity up until that moment. It is usually denoted by <span>$\lambda^*(t)$</span>.</p><pre><code class="language-julia hljs">function get_insta_rate(t,popstate)
  _train = popstate.trains_history[1]
  myinput[1] + H.interaction(t,_train,myw[1],popstate.unittype)
end
function plot_instarate(popstate,tlims=(1100,1120))
  tplot = range(tlims...;length=100)
  _train = popstate.trains_history[1]
  tspk = filter(t-&gt; tlims[1]&lt;=t&lt;=tlims[2],_train) # add the exact spiketimes for cleaner plot
  tplot = sort(vcat(tplot,tspk,tspk .- 1E-4))
  plt=plot(xlabel=&quot;time (s)&quot;,ylabel=&quot;instantaneous rate&quot;)
  plot!(plt,t-&gt;get_insta_rate(t,popstate),tplot;linewidth=2,color=:black)
  scatter!(t-&gt;get_insta_rate(t,popstate),tspk;leg=false)
  avg_rate = H.numerical_rates(popstate;Tend=Tmax)[1]
  ylim2 = ylims()[2]
  plot!(plt,tplot, fill(avg_rate,length(tplot)),
     color=:red,linestyle=:dash,ylims=(0,ylim2))
end
plot_instarate(popstate)</code></pre><img src="fdb81a8a.svg" alt="Example block output"/><h2 id="Plot-the-total-event-counts"><a class="docs-heading-anchor" href="#Plot-the-total-event-counts">Plot the total event counts</a><a id="Plot-the-total-event-counts-1"></a><a class="docs-heading-anchor-permalink" href="#Plot-the-total-event-counts" title="Permalink"></a></h2><p>Total number of events as a function of time. It grows linearly, and the steepness is pretty much the rate.</p><pre><code class="language-julia hljs">function plot_counts(tlims=(0.,1000.))
  avg_rate = H.numerical_rates(popstate;Tend=Tmax)[1]
  tplot = range(tlims...;length=100)
  _train = popstate.trains_history[1]
  nevents(tnow::Real) = count(t-&gt; t &lt;= tnow,_train)
  plt=plot(xlabel=&quot;time (s)&quot;,ylabel=&quot;number of events&quot;,leg=false)
  plot!(plt,tplot,nevents.(tplot),color=:black,linewidth=2)
  plot!(plt,tplot , tplot .* avg_rate,color=:red,linestyle=:dash)
end
plot_counts()</code></pre><img src="a530862e.svg" alt="Example block output"/><h2 id="Rate"><a class="docs-heading-anchor" href="#Rate">Rate</a><a id="Rate-1"></a><a class="docs-heading-anchor-permalink" href="#Rate" title="Permalink"></a></h2><p>Now I compare the numerical rate with the analytic solution.</p><p>The analytic rate corresponds to the stationary solution of a linear dynamical system (assumung all stationary rates are above zero).</p><p class="math-container">\[\frac{\mathrm d \mathbf r}{\mathrm d t} = - \mathbf r + W\;r + \mathbf h \quad;
\qquad  r_\infty = (I-W)^{-1} \; \mathbf h\]</p><pre><code class="language-julia hljs">rate_analytic = inv(I-myw)*myinput
rate_analytic = rate_analytic[1] # 1-D , just a scalar

@info &quot;Mean rate -  numerical $(round(ratenum;digits=2)), analytic  $(round(rate_analytic;digits=2))&quot;</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">[ Info: Mean rate -  numerical 4.5, analytic  4.67</code></pre><h2 id="Covariance-density"><a class="docs-heading-anchor" href="#Covariance-density">Covariance density</a><a id="Covariance-density-1"></a><a class="docs-heading-anchor-permalink" href="#Covariance-density" title="Permalink"></a></h2><p>Definition:</p><p class="math-container">\[C(\tau) = \left&lt; \left( S(t) - r \right) \left( S(t-\tau) - r \right) \right&gt;_t\]</p><p>Where <span>$r$</span> is the mean rate, and <span>$S(t)$</span> is the spike train.</p><p>Here I compute it numerically.</p><pre><code class="language-julia hljs">mytrain = popstate.trains_history[1]
mydt = 0.1
myτmax = 25.0
mytaus = H.get_times(mydt,myτmax)
ntaus = length(mytaus)
cov_times,cov_num = H.covariance_self_numerical(mytrain,mydt,myτmax);</code></pre><p>Now I compute the covariance density analytically, at higher resolution, and I compare the two.</p><pre><code class="language-julia hljs">function four_high_res(dt::Real,Tmax::Real) # higher time resolution, longer time
  k1,k2 = 2 , 0.01
  myτmax = Tmax * k1
  dt *= k2
  mytaus = H.get_times(dt,myτmax)
  nkeep = div(length(mytaus),k1)
  myfreq = H.get_frequencies_centerzero(dt,myτmax)
  gfou = myw[1,1] .* H.interaction_kernel_fourier.(myfreq,Ref(popstate)) |&gt; ifftshift
  ffou = let r=rate_analytic
    covf(g) = r/((1-g)*(1-g&#39;))
    map(covf,gfou)
  end
  retf = real.(ifft(ffou)) ./ dt
  retf[1] *= dt  # first element is rate
  return mytaus[1:nkeep],retf[1:nkeep]
end

(taush,covfou)=four_high_res(mydt,myτmax)

theplot =  let  plt = plot(xlabel=&quot;time delay (s)&quot;,ylabel=&quot;Covariance density&quot;)
  plot!(plt,cov_times[2:end], cov_num[2:end] ; linewidth=3, label=&quot;simulation&quot; )
  plot!(plt,taush[2:end],covfou[2:end]; label=&quot;analytic&quot;,linewidth=3,linestyle=:dash)
  plt
end;
plot(theplot)</code></pre><img src="52fba182.svg" alt="Example block output"/><p>1D system completed !</p><h2 id="2D-Hawkes-process,-same-stuff"><a class="docs-heading-anchor" href="#2D-Hawkes-process,-same-stuff">2D Hawkes process, same stuff</a><a id="2D-Hawkes-process,-same-stuff-1"></a><a class="docs-heading-anchor-permalink" href="#2D-Hawkes-process,-same-stuff" title="Permalink"></a></h2><pre><code class="language-julia hljs">myτ = 1/2.33
mywmat = [ 0.31   0.3
           0.9  0.15 ]
myin = [1.0,0.1]
p1 = H.KernelExp(myτ)
ps1 = H.PopulationState(p1,2)
ntw = H.RecurrentNetwork(ps1,mywmat,myin);</code></pre><h2 id="Start-the-simulation"><a class="docs-heading-anchor" href="#Start-the-simulation">Start the simulation</a><a id="Start-the-simulation-1"></a><a class="docs-heading-anchor-permalink" href="#Start-the-simulation" title="Permalink"></a></h2><p>the function <code>run_simulation!(...)</code> has been defined above Note that <code>n_spikes</code> is the total number of spikes among <strong>all</strong> units in the system.</p><pre><code class="language-julia hljs">n_spikes = 500_000

Tmax = run_simulation!(ntw,n_spikes,100.0,10.0);</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Running Hawkes process...   2%|▌                         |  ETA: 0:00:05Running Hawkes process...   4%|█                         |  ETA: 0:00:05Running Hawkes process...   6%|█▌                        |  ETA: 0:00:05Running Hawkes process...   8%|██▏                       |  ETA: 0:00:05Running Hawkes process...  10%|██▋                       |  ETA: 0:00:05Running Hawkes process...  12%|███▏                      |  ETA: 0:00:05Running Hawkes process...  14%|███▋                      |  ETA: 0:00:05Running Hawkes process...  16%|████▏                     |  ETA: 0:00:04Running Hawkes process...  18%|████▋                     |  ETA: 0:00:04Running Hawkes process...  20%|█████▏                    |  ETA: 0:00:04Running Hawkes process...  22%|█████▋                    |  ETA: 0:00:04Running Hawkes process...  23%|██████▏                   |  ETA: 0:00:04Running Hawkes process...  25%|██████▌                   |  ETA: 0:00:04Running Hawkes process...  27%|███████                   |  ETA: 0:00:04Running Hawkes process...  29%|███████▌                  |  ETA: 0:00:04Running Hawkes process...  31%|████████                  |  ETA: 0:00:04Running Hawkes process...  33%|████████▌                 |  ETA: 0:00:04Running Hawkes process...  35%|█████████                 |  ETA: 0:00:04Running Hawkes process...  37%|█████████▌                |  ETA: 0:00:03Running Hawkes process...  39%|██████████                |  ETA: 0:00:03Running Hawkes process...  41%|██████████▌               |  ETA: 0:00:03Running Hawkes process...  43%|███████████▏              |  ETA: 0:00:03Running Hawkes process...  44%|███████████▌              |  ETA: 0:00:03Running Hawkes process...  46%|████████████              |  ETA: 0:00:03Running Hawkes process...  48%|████████████▌             |  ETA: 0:00:03Running Hawkes process...  50%|█████████████             |  ETA: 0:00:03Running Hawkes process...  52%|█████████████▋            |  ETA: 0:00:03Running Hawkes process...  54%|██████████████▏           |  ETA: 0:00:02Running Hawkes process...  56%|██████████████▋           |  ETA: 0:00:02Running Hawkes process...  58%|███████████████▏          |  ETA: 0:00:02Running Hawkes process...  60%|███████████████▋          |  ETA: 0:00:02Running Hawkes process...  62%|████████████████▏         |  ETA: 0:00:02Running Hawkes process...  64%|████████████████▋         |  ETA: 0:00:02Running Hawkes process...  66%|█████████████████▏        |  ETA: 0:00:02Running Hawkes process...  68%|█████████████████▋        |  ETA: 0:00:02Running Hawkes process...  70%|██████████████████▏       |  ETA: 0:00:02Running Hawkes process...  72%|██████████████████▋       |  ETA: 0:00:02Running Hawkes process...  74%|███████████████████▏      |  ETA: 0:00:01Running Hawkes process...  75%|███████████████████▋      |  ETA: 0:00:01Running Hawkes process...  77%|████████████████████▏     |  ETA: 0:00:01Running Hawkes process...  79%|████████████████████▋     |  ETA: 0:00:01Running Hawkes process...  81%|█████████████████████▏    |  ETA: 0:00:01Running Hawkes process...  83%|█████████████████████▋    |  ETA: 0:00:01Running Hawkes process...  85%|██████████████████████▏   |  ETA: 0:00:01Running Hawkes process...  87%|██████████████████████▋   |  ETA: 0:00:01Running Hawkes process...  89%|███████████████████████▏  |  ETA: 0:00:01Running Hawkes process...  91%|███████████████████████▋  |  ETA: 0:00:00Running Hawkes process...  93%|████████████████████████  |  ETA: 0:00:00Running Hawkes process...  94%|████████████████████████▌ |  ETA: 0:00:00Running Hawkes process...  96%|█████████████████████████ |  ETA: 0:00:00Running Hawkes process...  98%|█████████████████████████▌|  ETA: 0:00:00Running Hawkes process... 100%|██████████████████████████| Time: 0:00:05</code></pre><h2 id="Rates:-numeric-Vs-analytic"><a class="docs-heading-anchor" href="#Rates:-numeric-Vs-analytic">Rates: numeric Vs analytic</a><a id="Rates:-numeric-Vs-analytic-1"></a><a class="docs-heading-anchor-permalink" href="#Rates:-numeric-Vs-analytic" title="Permalink"></a></h2><p>The analytic rate is from  Eq between 6 and  7 in Hawkes 1971</p><pre><code class="language-julia hljs">num_rates = H.numerical_rates(ps1)
myspikes_both = ps1.trains_history

ratefou = let G0 =  mywmat .* H.interaction_kernel_fourier(0,p1)
  inv(I-G0)*myin |&gt; real
end
rate_analytic = inv(I-mywmat)*myin

@info &quot;Total duration $(round(Tmax;digits=1)) s&quot;
@info &quot;Rates are $(round.(num_rates;digits=2))&quot;
@info &quot;Analytic rates are $(round.(rate_analytic;digits=2)) Hz&quot;</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">[ Info: Total duration 87285.8 s
[ Info: Rates are [2.73, 2.99]
[ Info: Analytic rates are [2.78, 3.06] Hz</code></pre><h2 id="Covariance-density-2"><a class="docs-heading-anchor" href="#Covariance-density-2">Covariance density</a><a class="docs-heading-anchor-permalink" href="#Covariance-density-2" title="Permalink"></a></h2><p>there are 4 combinations, therefore I will compare 4 lines.</p><pre><code class="language-julia hljs">mydt = 0.1
myτmax = 15.0
mytaus = H.get_times(mydt,myτmax)
ntaus = length(mytaus)
cov_times,cov_num = H.covariance_density_numerical(myspikes_both,mydt,myτmax)

theplot = let  plt=plot(xlabel=&quot;time delay (s)&quot;,ylabel=&quot;Covariance density&quot;)
  for i in 1:2, j in 1:2
    plot!(plt,cov_times[2:end-1],cov_num[2:end-1,i,j], linewidth = 3, label=&quot;cov $i-$j&quot;)
  end
  plt
end;
plot(theplot)</code></pre><img src="f3992662.svg" alt="Example block output"/><p>The analytic solution is eq 12 from Hawkes 1971</p><pre><code class="language-julia hljs">function four_high_res(dt::Real,Tmax::Real)
  k1 = 2
  k2 = 0.005
  myτmax,mydt = Tmax * k1, dt*k2
  mytaus = H.get_times(mydt,myτmax)
  nkeep = div(length(mytaus),k1)
  myfreq = H.get_frequencies_centerzero(mydt,myτmax)
  G_omega = map(mywmat) do w
    ifftshift( w .* H.interaction_kernel_fourier.(myfreq,Ref(p1)))
  end
  D = Diagonal(ratefou)
  M = Array{ComplexF64}(undef,length(myfreq),2,2)
  Mt = similar(M,Float64)
  for k in eachindex(myfreq)
    G = getindex.(G_omega,k)
    M[k,:,:] = (I-G)\D/(I-G&#39;)
  end
  for i in 1:2,j in 1:2
    Mt[:,i,j] = real.(ifft(M[:,i,j]))
    Mt[2:end,i,j] ./= mydt # diagonal of t=0 contains the rate
  end
  return mytaus[1:nkeep],Mt[1:nkeep,:,:]
end

taush,Cfou=four_high_res(mydt,myτmax)

function oneplot(i,j)
  plt=plot(xlabel=&quot;time delay (s)&quot;,ylabel=&quot;Covariance density&quot;,title=&quot;cov $i - $j&quot;)
  plot!(plt,mytaus[2:end],cov_num[2:end,i,j] ; linewidth = 3, label=&quot;simulation&quot;)
  plot!(plt,taush[2:end],Cfou[2:end,i,j]; linestyle=:dash, linewidth=3, label=&quot;analytic&quot;)
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">oneplot (generic function with 1 method)</code></pre><p>1</p><pre><code class="language-julia hljs">oneplot(1,1)</code></pre><img src="43ee3ea4.svg" alt="Example block output"/><p>2</p><pre><code class="language-julia hljs">oneplot(1,2)</code></pre><img src="a2b715f5.svg" alt="Example block output"/><p>3</p><pre><code class="language-julia hljs">oneplot(2,1)</code></pre><img src="15dbe735.svg" alt="Example block output"/><p>4</p><pre><code class="language-julia hljs">oneplot(2,2)</code></pre><img src="3eaa779f.svg" alt="Example block output"/><p><strong>THE END</strong></p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Monday 4 December 2023 12:21">Monday 4 December 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
