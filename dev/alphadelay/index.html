<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>1D Hawkes process with delayed alpha kernel · HawkesSimulator.jl</title><meta name="title" content="1D Hawkes process with delayed alpha kernel · HawkesSimulator.jl"/><meta property="og:title" content="1D Hawkes process with delayed alpha kernel · HawkesSimulator.jl"/><meta property="twitter:title" content="1D Hawkes process with delayed alpha kernel · HawkesSimulator.jl"/><meta name="description" content="Documentation for HawkesSimulator.jl."/><meta property="og:description" content="Documentation for HawkesSimulator.jl."/><meta property="twitter:description" content="Documentation for HawkesSimulator.jl."/><meta property="og:url" content="https://dylanfesta.github.io/HawkesSimulator.jl/alphadelay/"/><meta property="twitter:url" content="https://dylanfesta.github.io/HawkesSimulator.jl/alphadelay/"/><link rel="canonical" href="https://dylanfesta.github.io/HawkesSimulator.jl/alphadelay/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">HawkesSimulator.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>1D Hawkes process with delayed alpha kernel</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>1D Hawkes process with delayed alpha kernel</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/dylanfesta/HawkesSimulator.jl/blob/master/examples/alphadelay.jl" title="View source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="1D-Hawkes-process-with-delayed-alpha-kernel"><a class="docs-heading-anchor" href="#1D-Hawkes-process-with-delayed-alpha-kernel">1D Hawkes process with delayed alpha kernel</a><a id="1D-Hawkes-process-with-delayed-alpha-kernel-1"></a><a class="docs-heading-anchor-permalink" href="#1D-Hawkes-process-with-delayed-alpha-kernel" title="Permalink"></a></h1><p>In this example, I simulate either a 1D or a 2D Hawkes process, with a delayed-alpha interaction kernel</p><p class="math-container">\[g(t) = H(t-t_{\text{delay}}) \,  \frac{(t-t_{\text{delay}})}{\tau^2} \,
 \exp\left(- \frac{(t-t_{\text{delay}})}{\tau} \right)\]</p><p>where <span>$H(x)$</span> is the Heaviside function: <span>$H(x)=0$</span> for <span>$x&lt;0$</span>, <span>$H(x)=1$</span> for <span>$t\geq 0$</span>.</p><p>Kernels are always normalized so that their integral is 1.</p><h2 id="Initialization"><a class="docs-heading-anchor" href="#Initialization">Initialization</a><a id="Initialization-1"></a><a class="docs-heading-anchor-permalink" href="#Initialization" title="Permalink"></a></h2><pre><code class="language-julia hljs">using LinearAlgebra,Statistics,StatsBase,Distributions
using Plots,NamedColors ; theme(:default) #; plotlyjs()
using FFTW

using ProgressMeter
using Random
Random.seed!(0)

using HawkesSimulator; const global H = HawkesSimulator</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">HawkesSimulator</code></pre><h2 id="Define-and-visualize-the-kernel"><a class="docs-heading-anchor" href="#Define-and-visualize-the-kernel">Define and visualize the kernel</a><a id="Define-and-visualize-the-kernel-1"></a><a class="docs-heading-anchor-permalink" href="#Define-and-visualize-the-kernel" title="Permalink"></a></h2><pre><code class="language-julia hljs">mytau = 0.5
mydelay = 2.0
myw = fill(0.85,(1,1)) # 1x1 matrix
myinput = [0.5,]       # 1-dim vector

ker = H.KernelAlphaDelay(mytau,mydelay)

plt = let ts = range(-0.5,8;length=150)
  y = [H.interaction_kernel(_t,ker) for _t in ts]
  plt=plot(ts,y ; linewidth=3,leg=false,xlabel=&quot;time (s)&quot;,
      ylabel=&quot;interaction kernel&quot;)
  ymax=ylims()[2]
  plot!(plt,[0,0],[0,ymax];linestyle=:dash,linecolor=:black)
end;
plot(plt)</code></pre><img src="4b7e2d92.svg" alt="Example block output"/><p>Note that the kernel starts after zero, according to the delay indicated.</p><p>As a side note: in order to simulate Hawkes processes, one always needs to define a <em>non-increasing upper limit</em> to the kernel. This is what it looks like for this kernel.</p><pre><code class="language-julia hljs">plt = let  ts = range(-0.5,8;length=150)
  y = [H.interaction_kernel(_t,ker) for _t in ts]
  yu = [H.interaction_kernel_upper(_t,ker) for _t in ts]
  plt = plot(ts,y ; linewidth=3,xlabel=&quot;time (s)&quot;,
      ylabel=&quot;interaction kernel&quot;, label=&quot;true kernel&quot;)
  plot!(plt, ts,yu ; linewidth=2, label=&quot;upper limit&quot;, linestyle=:dash)
  ymax=ylims()[2]
  plot!(plt,[0,0],[0,ymax];linestyle=:dash,linecolor=:black,label=&quot;&quot;)
end;
plot(plt)</code></pre><img src="ae94e452.svg" alt="Example block output"/><p>the closer the upper limit is to the true kernel, the more efficient the simulation.</p><h2 id="Build-the-network-and-run-it"><a class="docs-heading-anchor" href="#Build-the-network-and-run-it">Build the network and run it</a><a id="Build-the-network-and-run-it-1"></a><a class="docs-heading-anchor-permalink" href="#Build-the-network-and-run-it" title="Permalink"></a></h2><p>I compare the final rate with what I expect from the analytic solution (see first example file)</p><pre><code class="language-julia hljs">pops = H.PopulationState(ker,1)
ntw = H.RecurrentNetwork(pops,myw,myinput)

function run_simulation!(network,num_spikes,
    t_flush_trigger=300.0,t_flush=100.0)
  t_now = 0.0
  H.reset!(network) # clear spike trains etc
  @showprogress &quot;Running Hawkes process...&quot; for _ in 1:num_spikes
    t_now = H.dynamics_step_singlepopulation!(t_now,network)
    H.flush_trains!(network,t_flush_trigger;Tflush=t_flush)
  end
  H.flush_trains!(network) # flush everything into history
  return t_now
end

n_spikes = 80_000
Tmax = run_simulation!(ntw,n_spikes);

ratenum = H.numerical_rates(pops)[1]
rate_analytic = (I-myw)\myinput
rate_analytic = rate_analytic[1] # from 1-dim vector to scalar

@info &quot;Mean rate -  numerical $(round(ratenum;digits=2)), analytic  $(round(rate_analytic;digits=2))&quot;</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Running Hawkes process...   7%|█▉                        |  ETA: 0:00:01Running Hawkes process... 100%|██████████████████████████| Time: 0:00:01
[ Info: Mean rate -  numerical 3.18, analytic  3.33</code></pre><h2 id="Covariance-density"><a class="docs-heading-anchor" href="#Covariance-density">Covariance density</a><a id="Covariance-density-1"></a><a class="docs-heading-anchor-permalink" href="#Covariance-density" title="Permalink"></a></h2><p>First, compute covariance density numerically for a reasonable time step</p><pre><code class="language-julia hljs">mytrain = pops.trains_history[1]
mydt = 0.1
myτmax = 60.0
mytaus = H.get_times(mydt,myτmax)
ntaus = length(mytaus)
cov_times,cov_num = H.covariance_self_numerical(mytrain,mydt,myτmax);</code></pre><p>now compute covariance density analytically (as in Hawkes models), at higher resolution, and compare analytic and numeric</p><p>Note that the high resolution is not just for a better plot, but also to ensure the result is more precise when we move from frequency domain (Fourier transforms) to time domain.</p><pre><code class="language-julia hljs">function four_high_res(dt::Real,Tmax::Real) # higher time resolution, longer time
  k1,k2 = 2 , 0.01
  myτmax = Tmax * k1
  dt *= k2
  mytaus = H.get_times(dt,myτmax)
  nkeep = div(length(mytaus),k1)
  myfreq = H.get_frequencies_centerzero(dt,myτmax)
  gfou = myw[1,1] .* H.interaction_kernel_fourier.(myfreq,Ref(ker)) |&gt; ifftshift
  ffou = let r=rate_analytic
    covf(g) = r/((1-g)*(1-g&#39;))
    map(covf,gfou)
  end
  retf = real.(ifft(ffou))
  retf[2:end] ./= dt # first element is rate
  return mytaus[1:nkeep],retf[1:nkeep]
end

taush,covfou=four_high_res(mydt,myτmax)

theplot = let plt = plot(xlabel=&quot;time delay (s)&quot;,ylabel=&quot;Covariance density&quot;)
  plot!(plt,cov_times[2:end], cov_num[2:end] ; linewidth=3, label=&quot;numerical&quot; )
  plot!(plt,taush[2:end],covfou[2:end]; label=&quot;analytic&quot;,linewidth=3,linestyle=:dash)
end;
plot(theplot)</code></pre><img src="178eed7d.svg" alt="Example block output"/><p>Analytics and numerics match quite well, although not perfectly. Whatever.</p><p><strong>THE END</strong></p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Wednesday 21 February 2024 09:26">Wednesday 21 February 2024</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
